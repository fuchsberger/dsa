<div class='d-flex justify-content-between'>
  <h6 class='mb-0'>
    <button
      class='btn btn-sm btn-link p-0'
      phx-click='toggle'
      phx-value-edit='advantages'
      type='button'
    ><i class='icon-<%= if @edit?, do: "cancel", else: "edit" %>'></i></button>
    Vorteile
  </h6>
  <i><%= @ap %> AP</i>
</div>
<hr class='my-1'>

<p class='small<%= if @edit?, do: " d-none" %>'>
  <%=
    @f.source.data.advantages
    |> Enum.map(fn %{advantage_id: id, details: details, level: level} ->
        "#{Advantage.name(id)}#{if Advantage.level(id) > 1, do: " #{roman(level)}"}#{details && ": #{details}"}"
      end)
    |> Enum.join(", ")
  %>
</p>

<table class='table table-xs<%= unless @edit?, do: " d-none" %>'>
  <thead>
    <tr>
      <th scope='col'>Name</th>
      <th class='text-center' scope='col'>LVL</th>
      <th class='text-center' scope='col'>AP</th>
      <th class='text-center p-0' scope='col'><i class='icon-remove'></i></th>
    </tr>
  </thead>
  <tbody>
  <%= for fs <- inputs_for(@f, :advantages) do %>
    <% id = input_value(fs, :advantage_id) %>
    <tr >
      <td>
        <%= Advantage.name(id) %>
        <%= if Advantage.details(id), do:
          text_input fs, :details, class: "small", placeholder: "Details..."
        %>
      </td>
      <td class='text-center p-0' style="width: 50px;">
        <%= if Advantage.level(id) > 1, do:
          select fs, :level, Advantage.level_options(id), class: "small py-0"
        %>
      </td>
      <td class='text-center' style="width: 55px;">
        <%= hidden_inputs_for(fs) %>
        <%= if Advantage.fixed_ap(id) do %>
          <%= input_value(fs, :level) * Advantage.ap(id) %>
        <% else %>
          <%= number_input fs, :ap, class: "small" %>
        <% end %>
      </td>
      <td class='text-center p-0'>
        <button
          type='button'
          class='btn btn-link btn-sm p-0'
          phx-click='remove'
          phx-value-id='<%= id %>'
          phx-value-type='advantage'
        ><i class='icon-cancel text-danger'></i></button>
      </td>
    </tr>
  <% end %>
  <tr>
    <td colspan='4'>
      <%= select @f, :advantage_id, Advantage.options(@f.data.advantages),
        class: "form-select-sm font-italic",
        prompt: "hinzufÃ¼gen..."
      %>
    </td>
  </tr>
  </tbody>
</table>
